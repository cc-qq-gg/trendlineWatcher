# è¶‹åŠ¿çº¿ç›‘æµ‹ç³»ç»Ÿ

åŸºäºç°æœ‰é‡åŒ–äº¤æ˜“æ¡†æ¶çš„è¶‹åŠ¿çº¿ç›‘æµ‹ç³»ç»Ÿï¼Œæä¾›Webç•Œé¢è¿›è¡Œè¶‹åŠ¿çº¿ç®¡ç†å’Œå®æ—¶çªç ´ç›‘æµ‹ã€‚

## ç³»ç»Ÿç‰¹ç‚¹

- âœ… **å®Œå…¨å¤ç”¨ç°æœ‰ä»£ç **ï¼šåŸºäºç°æœ‰çš„Kçº¿æ•°æ®è·å–å’Œè¶‹åŠ¿çº¿è®¡ç®—é€»è¾‘
- ğŸ“Š **å¯è§†åŒ–ç•Œé¢**ï¼šç›´è§‚çš„Webç•Œé¢ç®¡ç†è¶‹åŠ¿çº¿
- ğŸš¨ **å®æ—¶ç›‘æµ‹**ï¼šè‡ªåŠ¨ç›‘æµ‹çªç ´/è·Œç ´ä¿¡å·
- ğŸ’¾ **CSVå­˜å‚¨**ï¼šä½¿ç”¨CSVæ–‡ä»¶å­˜å‚¨é…ç½®å’Œæ—¥å¿—
- ğŸ”„ **é’‰é’‰é€šçŸ¥**ï¼šé›†æˆç°æœ‰çš„é’‰é’‰é€šçŸ¥åŠŸèƒ½

## æ–‡ä»¶ç»“æ„

```
quantauto/
â”œâ”€â”€ TrendlineManager.py      # è¶‹åŠ¿çº¿é…ç½®ç®¡ç†ï¼ˆCSVå­˜å‚¨ï¼‰
â”œâ”€â”€ TrendlineMonitor.py      # ç›‘æµ‹å¼•æ“ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
â”œâ”€â”€ TrendlineWebApp.py       # Webåº”ç”¨ï¼ˆFlaskï¼‰
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html           # Webç•Œé¢
â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ trendlines.csv       # è¶‹åŠ¿çº¿é…ç½®
â”‚   â””â”€â”€ monitor_logs.csv     # ç›‘æµ‹æ—¥å¿—
â”œâ”€â”€ run_trendline_monitor.py # å¯åŠ¨è„šæœ¬
â””â”€â”€ requirements.txt         # Pythonä¾èµ–
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. è¶‹åŠ¿çº¿ç®¡ç†
- âœ… åˆ›å»ºè¶‹åŠ¿çº¿ï¼ˆèµ·ç‚¹ã€ç»ˆç‚¹ã€æ–¹å‘ï¼‰
- âœ… ç¼–è¾‘è¶‹åŠ¿çº¿é…ç½®
- âœ… åˆ é™¤è¶‹åŠ¿çº¿
- âœ… å¯ç”¨/ç¦ç”¨ç›‘æµ‹
- âœ… å¯¼å…¥/å¯¼å‡ºé…ç½®

### 2. å®æ—¶ç›‘æµ‹
- âœ… å¤ç”¨ `ccxt_fetch_candle_data()` è·å–Kçº¿æ•°æ®
- âœ… å¤ç”¨ `define_trendline()` è®¡ç®—è¶‹åŠ¿çº¿
- âœ… å¤ç”¨ `monitor_breakout()` æ£€æµ‹çªç ´
- âœ… æ”¯æŒå¤šå¤´çªç ´å’Œç©ºå¤´è·Œç ´ç­–ç•¥
- âœ… é’‰é’‰é€šçŸ¥é›†æˆ

### 3. Webç•Œé¢
- ğŸ“Š Kçº¿å›¾è¡¨å¯è§†åŒ–
- ğŸ“ˆ è¶‹åŠ¿çº¿æ˜¾ç¤º
- ğŸ“‹ è¶‹åŠ¿çº¿åˆ—è¡¨ç®¡ç†
- ğŸ“ ç›‘æµ‹æ—¥å¿—æŸ¥çœ‹
- âš™ï¸ ç›‘æµ‹çŠ¶æ€æ§åˆ¶

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨ç³»ç»Ÿ
```bash
python run_trendline_monitor.py
```

### 3. è®¿é—®Webç•Œé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:5000

### 4. æ·»åŠ è¶‹åŠ¿çº¿
1. ç‚¹å‡»"æ–°å¢è¶‹åŠ¿çº¿"
2. å¡«å†™è¶‹åŠ¿çº¿ä¿¡æ¯ï¼š
   - åç§°ï¼šè¶‹åŠ¿çº¿çš„æè¿°åç§°
   - äº¤æ˜“å¯¹ï¼šå¦‚ SOL-USDT-SWAP
   - èµ·ç‚¹ï¼šæ—¶é—´å’Œä»·æ ¼
   - ç»ˆç‚¹ï¼šæ—¶é—´å’Œä»·æ ¼
   - æ–¹å‘ï¼šå¤šå¤´çªç ´æˆ–ç©ºå¤´è·Œç ´

### 5. å¯åŠ¨ç›‘æµ‹
1. åœ¨Webç•Œé¢ç‚¹å‡»"å¯åŠ¨ç›‘æµ‹"
2. ç³»ç»Ÿä¼šè‡ªåŠ¨ç›‘æµ‹çªç ´ä¿¡å·
3. æ£€æµ‹åˆ°çªç ´æ—¶ä¼šå‘é€é’‰é’‰é€šçŸ¥

## APIæ¥å£

### è¶‹åŠ¿çº¿ç®¡ç†
- `GET /api/trendlines` - è·å–æ‰€æœ‰è¶‹åŠ¿çº¿
- `POST /api/trendlines` - åˆ›å»ºè¶‹åŠ¿çº¿
- `GET /api/trendlines/{id}` - è·å–å•ä¸ªè¶‹åŠ¿çº¿
- `PUT /api/trendlines/{id}` - æ›´æ–°è¶‹åŠ¿çº¿
- `DELETE /api/trendlines/{id}` - åˆ é™¤è¶‹åŠ¿çº¿

### ç›‘æµ‹åŠŸèƒ½
- `GET /api/monitor/status` - è·å–ç›‘æµ‹çŠ¶æ€
- `POST /api/monitor/start` - å¯åŠ¨ç›‘æµ‹
- `POST /api/monitor/stop` - åœæ­¢ç›‘æµ‹
- `POST /api/trendlines/{id}/check` - æ£€æŸ¥è¶‹åŠ¿çº¿
- `GET /api/trendlines/{id}/data` - è·å–è¶‹åŠ¿çº¿æ•°æ®

### æ•°æ®æŸ¥è¯¢
- `GET /api/logs` - è·å–ç›‘æµ‹æ—¥å¿—
- `GET /api/candles` - è·å–Kçº¿æ•°æ®
- `GET /api/export` - å¯¼å‡ºé…ç½®
- `POST /api/import` - å¯¼å…¥é…ç½®

## æ•°æ®æ ¼å¼

### è¶‹åŠ¿çº¿é…ç½® (trendlines.csv)
```csv
id,name,symbol,start_time,start_price,end_time,end_price,direction,status,created_at,updated_at
uuid,SOLä¸Šå‡è¶‹åŠ¿çº¿,SOL-USDT-SWAP,2025-05-09 18:00:00,174.25,2025-05-14 06:00:00,183.44,1,active,2025-01-01T10:00:00,2025-01-01T10:00:00
```

### ç›‘æµ‹æ—¥å¿— (monitor_logs.csv)
```csv
id,trendline_id,signal_type,price,trendline_value,detected_at
uuid,uuid,breakout,175.50,175.20,2025-01-01T15:30:00
```

## å¤ç”¨çš„ç°æœ‰ç»„ä»¶

### Kçº¿æ•°æ®è·å–
- **å‡½æ•°**: `Function.ccxt_fetch_candle_data()`
- **åŠŸèƒ½**: ä»OKXè·å–Kçº¿æ•°æ®
- **å¤ç”¨æ–¹å¼**: ç›´æ¥è°ƒç”¨

### è¶‹åŠ¿çº¿è®¡ç®—
- **å‡½æ•°**: `Signals.define_trendline()`
- **åŠŸèƒ½**: æ ¹æ®ä¸¤ç‚¹è®¡ç®—è¶‹åŠ¿çº¿å€¼
- **å¤ç”¨æ–¹å¼**: ç›´æ¥è°ƒç”¨

### çªç ´æ£€æµ‹
- **å‡½æ•°**: `Signals.monitor_breakout()`
- **åŠŸèƒ½**: æ£€æµ‹çªç ´/è·Œç ´ä¿¡å·
- **å¤ç”¨æ–¹å¼**: ç›´æ¥è°ƒç”¨

### é€šçŸ¥ç³»ç»Ÿ
- **å‡½æ•°**: `Function.send_dingding_msg()`
- **åŠŸèƒ½**: å‘é€é’‰é’‰é€šçŸ¥
- **å¤ç”¨æ–¹å¼**: ç›´æ¥è°ƒç”¨

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºè¶‹åŠ¿çº¿
```python
from TrendlineManager import TrendlineManager

manager = TrendlineManager()
trendline_id = manager.create_trendline(
    name="SOLä¸Šå‡è¶‹åŠ¿çº¿",
    symbol="SOL-USDT-SWAP",
    start_point=["2025-05-09 18:00:00", 174.25],
    end_point=["2025-05-14 06:00:00", 183.44],
    direction=1  # å¤šå¤´çªç ´
)
```

### å¯åŠ¨ç›‘æµ‹
```python
from TrendlineMonitor import start_global_monitoring

start_global_monitoring(
    symbols=["SOL-USDT-SWAP"],
    time_interval="5m"
)
```

### æ£€æŸ¥çªç ´ä¿¡å·
```python
monitor = TrendlineMonitor()
signal = monitor.check_trendline_now(trendline_id)
if signal == 1:
    print("æ£€æµ‹åˆ°å¤šå¤´çªç ´ä¿¡å·")
elif signal == -1:
    print("æ£€æµ‹åˆ°ç©ºå¤´è·Œç ´ä¿¡å·")
```

## æ³¨æ„äº‹é¡¹

1. **æ—¶é—´æ ¼å¼**: ä½¿ç”¨ `YYYY-MM-DD HH:MM:SS` æ ¼å¼
2. **äº¤æ˜“å¯¹**: ç¡®ä¿äº¤æ˜“å¯¹åç§°æ­£ç¡®ï¼ˆå¦‚ SOL-USDT-SWAPï¼‰
3. **æ•°æ®èŒƒå›´**: ç¡®ä¿è¶‹åŠ¿çº¿æ—¶é—´ç‚¹åœ¨Kçº¿æ•°æ®èŒƒå›´å†…
4. **ç›‘æµ‹é¢‘ç‡**: é»˜è®¤30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´
5. **APIé™åˆ¶**: æ³¨æ„OKX APIçš„è°ƒç”¨é¢‘ç‡é™åˆ¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è·å–Kçº¿æ•°æ®**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œä»£ç†è®¾ç½®
   - ç¡®è®¤APIå¯†é’¥é…ç½®æ­£ç¡®

2. **è¶‹åŠ¿çº¿è®¡ç®—é”™è¯¯**
   - æ£€æŸ¥æ—¶é—´æ ¼å¼æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æ—¶é—´ç‚¹åœ¨æ•°æ®èŒƒå›´å†…

3. **Webç•Œé¢æ— æ³•è®¿é—®**
   - ç¡®è®¤ç«¯å£5000æœªè¢«å ç”¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

4. **ç›‘æµ‹æœªå¯åŠ¨**
   - æ£€æŸ¥æ˜¯å¦æœ‰æ´»è·ƒçš„è¶‹åŠ¿çº¿é…ç½®
   - ç¡®è®¤äº¤æ˜“å¯¹é…ç½®æ­£ç¡®

## æ‰©å±•åŠŸèƒ½

ç³»ç»Ÿè®¾è®¡ä¸ºå¯æ‰©å±•çš„æ¶æ„ï¼Œå¯ä»¥è½»æ¾æ·»åŠ ï¼š
- æ›´å¤šäº¤æ˜“æ‰€æ”¯æŒ
- è‡ªå®šä¹‰é€šçŸ¥æ¸ é“
- æ›´å¤æ‚çš„ç›‘æµ‹ç­–ç•¥
- æ•°æ®åˆ†æå’ŒæŠ¥å‘ŠåŠŸèƒ½